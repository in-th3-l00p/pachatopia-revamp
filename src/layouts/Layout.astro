---
import "../styles/global.css";

interface Props {
  title: string;
  description?: string;
  lang?: "fr" | "en";
  image?: string;
  type?: string;
}

const {
  title,
  description = "Pachatopia - Association pour l'agriculture durable, la création de réserves naturelles et un mode de vie éco-responsable, inspirée par la sagesse amérindienne et le respect de la Pachamama.",
  lang = "fr",
  image = "/images/farm-hero.jpg",
  type = "website",
} = Astro.props;

const siteUrl = "https://pachatopia.org";
const currentPath = Astro.url.pathname;
const canonicalUrl = new URL(currentPath, siteUrl).href;
const ogImage = new URL(image, siteUrl).href;

// Build alternate language URL
const isEnglish = currentPath.startsWith("/en/") || currentPath === "/en";
const frPath = isEnglish ? currentPath.replace(/^\/en\/?/, "/") : currentPath;
const enPath = isEnglish ? currentPath : `/en${currentPath}`;
const frUrl = new URL(frPath || "/", siteUrl).href;
const enUrl = new URL(enPath, siteUrl).href;

// JSON-LD structured data
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "NonprofitOrganization",
  name: "Pachatopia",
  url: siteUrl,
  logo: new URL("/images/logoo.png", siteUrl).href,
  description: lang === "en"
    ? "Non-profit association dedicated to sustainable agriculture, natural reserve creation, and eco-responsible living inspired by Indigenous wisdom."
    : "Association dédiée à l'agriculture durable, la création de réserves naturelles et un mode de vie éco-responsable inspiré de la sagesse amérindienne.",
  foundingDate: "2024",
  areaServed: ["Colombia", "France", "Europe"],
  knowsLanguage: ["fr", "en"],
  sameAs: [],
  contactPoint: {
    "@type": "ContactPoint",
    telephone: "+33631663624",
    contactType: "general",
    availableLanguage: ["French", "English"],
  },
};

const webSiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "Pachatopia",
  url: siteUrl,
  inLanguage: [lang === "en" ? "en" : "fr"],
  potentialAction: {
    "@type": "ReadAction",
    target: siteUrl,
  },
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <link rel="canonical" href={canonicalUrl} />

    <!-- Language Alternates -->
    <link rel="alternate" hreflang="fr" href={frUrl} />
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="x-default" href={frUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:locale" content={lang === "en" ? "en_US" : "fr_FR"} />
    <meta property="og:locale:alternate" content={lang === "en" ? "fr_FR" : "en_US"} />
    <meta property="og:site_name" content="Pachatopia" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalUrl} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />

    <!-- Additional SEO -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="theme-color" content="#0B5B4B" />
    <meta name="author" content="Pachatopia" />
    <meta name="keywords" content={lang === "en"
      ? "Pachatopia, sustainable agriculture, natural reserve, eco-responsible, Pachamama, Colombia, volunteering, ecological currency, PachaCoin"
      : "Pachatopia, agriculture durable, réserve naturelle, éco-responsable, Pachamama, Colombie, bénévolat, monnaie écologique, PachaCoin"
    } />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(webSiteSchema)} />
  </head>
  <body class="min-h-screen bg-white text-gray-800 font-sans antialiased">
    <slot />
  </body>
</html>
